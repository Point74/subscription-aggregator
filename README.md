# Subscription Aggregator

Subscription Aggregator - REST сервис для агрегации данных о подписках пользователей на различные онлайн-сервисы.
Сервис позволяет создавать, обновлять, удалять и получать информацию о подписках, а также рассчитывать общую стоимость подписок за определенный период.

## Основные возможности

- **CRUDL операции** с подписками пользователей
- **Расчет общей стоимости** подписок за период для конкретного сервиса
- **Swagger документация** API `http://localhost:8080/swagger/`
- **Интеграция с PostgreSQL** для хранения данных

## Технический стек

- **Go** - основной язык разработки
- **Chi Router** - HTTP роутер и middleware
- **PostgreSQL** - база данных для хранения подписок
- **Swagger** - документация API
- **golang-migrate** - для миграции базы данных
- **Slog** - структурированное логирование

## Запуск приложения

### Требования

- Go 1.21+
- Docker и Docker Compose
- Настроенные переменные окружения для подключения к БД

### Установка и запуск

1. Клонируйте репозиторий
   ```
   git clone https://github.com/Point74/subscription-aggregator.git
   ```
2. Установите зависимости:
   ```
   go mod download
   ```
3. Создайте файл в корневой папке проекта с именем ``.env`` . Убедитесь, что имя файла начинается с точки.
   Откройте файл ``.env`` в любом текстовом редакторе и вставьте в него следующие строки:
   ```
   POSTGRES_USER=user
   POSTGRES_PASSWORD=password
   POSTGRES_DB=postgres
   POSTGRES_PORT=5432
   POSTGRES_HOST=postgres
   APP_PORT=8080
   ```
4. Запустите приложение через команду в корне проекта:
   ```
   docker-compose up -d
   ```
5. Настройте подключение к PostgreSQL

Сервис будет доступен на порту **8080**.


### API Эндпоинты

**1. Создание подписки**

* `POST /subscriptions`
* **Описание**: Создаёт новую подписку.
* **Тело запроса**:
    ```json
    {
       "service_name": "Yandex Plus",
       "price": 400,
       "user_id": "84883494-b159-4592-8877-a877995a9478",
       "start_date": "07-2025",
       "end_date": "08-2025"
    }
    ```
    * **Особенности**:
        * Поле `end_date` является опциональным.
        * Все даты должны быть в формате **`MM-YYYY`**.

**2. Получение списка подписок**

* `GET /subscriptions?user_id={user_id}`
* **Описание**: Возвращает список всех подписок для указанного пользователя.
* **Параметры запроса**:
    * `user_id` (обязательный) - ID пользователя.

**3. Получение подписки по ID**

* `GET /subscriptions/{id}`
* **Описание**: Возвращает информацию о подписке по её уникальному ID.
* **Параметры пути**:
    * `id` (обязательный) - ID подписки.

**4. Обновление подписки**

* `PUT /subscriptions/{id}`
* **Описание**: Обновляет существующую подписку по её ID.
* **Параметры пути**:
    * `id` (обязательный) - ID подписки.
* **Тело запроса**: `models.SubscriptionRequest` (аналогично созданию).

**5. Удаление подписки**

* `DELETE /subscriptions/{id}`
* **Описание**: Удаляет подписку по её ID.
* **Параметры пути**:
    * `id` (обязательный) - ID подписки.

**6. Расчёт общей стоимости**

* `GET /subscriptions/total-cost`
* **Описание**: Подсчитывает общую стоимость подписок за период с фильтрацией по сервису и пользователю.
* **Параметры запроса**:
    * `user_id` (обязательный) - ID пользователя.
    * `service_name` (обязательный) - название сервиса.
    * `period_start` (обязательный) - дата начала периода в формате **`MM-YYYY`**.
    * `period_end` (обязательный) - дата окончания периода в формате **`MM-YYYY`**.
